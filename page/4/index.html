<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coding Journal &middot; Coding Journal</title>

    <meta name="description" content="Adventures in the world of C#, F# and WinRT">

    <meta name="generator" content="Hugo 0.14" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Coding Journal &middot; Coding Journal">
    <meta name="twitter:description" content="Adventures in the world of C#, F# and WinRT">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Coding Journal &middot; Coding Journal">
    <meta property="og:description" content="Adventures in the world of C#, F# and WinRT">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="https://github.com:1313/igorkulman/coding-journal//css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Coding Journal" href="https://github.com:1313/igorkulman/coding-journal//index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://github.com:1313/igorkulman/coding-journal/">Coding Journal</a></h1>
            <h2 class="brand-tagline"> Adventures in the world of C#, F# and WinRT </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/igorkulman"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/igorkulman "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com:1313/igorkulman/coding-journal//index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>

<div>
<h2>About me</h2>

<p>Igor Kulman is currently working as Windows Phone developer, also building applications for Microsoft Azure and playing with F#.</p>
<p>
Interested in programming languages, functional programming and data science.</p>

</div>

    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">29 Aug 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/experience-with-being-featured-in-the-red-stripe-deal-promotion-on-windows-phone/" class="post-title">Experience with being featured in the Red Stripe Deal promotion on Windows Phone</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I was offered to to take part in the Red Stripe Deal promotion on Windows Phone with my <a href="http://shoppinglist.kulman.sk/">Shopping List Simple</a> app from 21st August to 28th August.</p>

<p><img src="/images/sk.png" alt="" class="pure-img" ></p>

<p>In this promotion, your app has to cost less than half of the normal price. The app normally costs 1.29 USD in most countries and 0.99 USD in Czech Republic, Slovakia and Russia to boost the sales. The minimum price in Windows Phone Store is 0.99 USD so the app had to be made free for the promotion. So I filled in the form saying that I want my app to be free in all the countries during the promotion. When the time of the promotion came, the price was set to free in all the countries except Czech Republic, Slovakia and Russia. First day, first problem.</p>

<p><strong>Positives</strong></p>

<p>The promotion was a success with about 25 000 (free) downloads.</p>

<p>Another positive effect was that I got contacted by users offering translations of the app and acquired Turkish and Ukrainian translations.</p>

<p><strong>Negatives</strong></p>

<p>As soon as the Red Stripe Deal promotion ended, I submitted a new version of the app with the two new translations &#8230; and the problems started. The users started to report that the update fails to install, usually with 80004005 as the error code. If you try to google this code, you find out it is too generic, ranging from Zune to XBOX and that no helpful info can be found about this error code.</p>

<p>I contacted Microsoft support and they, as usual, were not helpful at all. They replied that everything is ok with the app, the error code indicates WiFi issues, so it is a problem on the users&#8217; end and that they should contact the support.</p>

<p>There was another problem. Users who got the app for free thanks to the Red Stripe Deal and uninstalled it, had to pay for when reinstalling. This really sucks and I am sure that in the past, when you got an app while it was free you never had to pay for it in the future. It looks like things changed, because I got this from Microsoft:</p>

<blockquote>
<p><del datetime="2014-08-29T17:04:05+00:00">In regards to users having to pay for the app if they re-install it, this works as designed. If the app was free when it was downloaded and the price changes between the time the consumer re-installs they will be charged whatever the “New” price is.</del></p>
</blockquote>

<p>Looks like this was an misinformation from Microsoft, they corrected it:</p>

<blockquote>
<p>Let me correct myself. The only time I see the app being changed is when I use a device that is not tied to the live Id that I purchased it from. If I buy an app under myself@live.com and then login to another device using a different live Id I will have to pay for the app. If I use the same live Id I own the app and will not have to pay even if the price of the app has changed. You will also see a change for the app if I have loaded the app on the maximum number of devices allowed.</p>
</blockquote>

<p>The other error code, that the users were experiencing, was c101a7d1. Microsoft support sent my a link to a <a href="https://answers.microsoft.com/en-us/winphone/forum/wp7-sync/errors-of-c101a7d1-and-c101a006-on-windows-phone/822ec1be-9d07-4c0a-a4eb-7c6edf63e52d?page=2">discussion suggesting users uninstall the app and install it again</a>, meaning they would have to pay for it now (according to users who tried it), maybe all 25 000 of them! This is going to be a real blow to the reviews and ratings! And some people even thing I did it intentionally to make money!</p>

<p><strong>Conclusion</strong></p>

<p>So what did the Red Stripe Deal bring me? Many new users, but many of them angry about the update problems and need to buy the app when they uninstall it and it also made some of the &#8220;old&#8221; users angry about the update problem. Was it worth it?</p>

<p><strong>Update</strong>: Problem still not solved.</p>

<p>I told the users to contact Microsoft support as Microsoft support told me, but they report the support cannot / will not help them. The support guy I am in contact with did not want to believe this, so I had to ask one user for a screenshot of Microsoft support telling him they cannot help and send it to him. Did not help either.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">23 Jul 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/automatic-viewmodels-and-services-registration-for-not-only-caliburn-micro/" class="post-title">Automatic ViewModels and Services registration for (not only) Caliburn.Micro</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>My MVVM framework of choice, Caliburn.Micro, provides a simple Dependency Injection container, where you have to register all your ViewModels and Services. This is done in the Bootstraper&#8217;s Configure method and may look like this:</p>

<script src="https://gist.github.com/igorkulman/0353b26073fc11d3635f.js?file=reg1.cs"></script>

<p>where you typically register your ViewModels as per request and services as singletons.</p>

<p>Of course this is done just once, but having to register a ViewModel each time you create a new one can be a nuisance, especially in a large project.</p>

<p>There is a better way that uses reflection. First, you need to create attributes that will represent registration as per request and a s singleton:</p>

<script src="https://gist.github.com/igorkulman/0353b26073fc11d3635f.js?file=PerRequest.cs"></script>

<script src="https://gist.github.com/igorkulman/0353b26073fc11d3635f.js?file=Singleton.cs"></script>

<p>Iterating over all the non-abstract classes in your assemblies using reflection is quite easy, the tricky part is deciding when to register a class as &#8220;itself&#8221; and when to register it for an interface it implements. My rule of thumbs is that if the class implements exactly one interface, it is one of my services and I register it for that interface, otherwise I register it as itself (ViewModels descendant from Screen implement circa 5 interfaces).</p>

<p>The final registration code looks different for WinRT (Windows 8, Windows 8.1, Windows Phone 8.1 XAML)</p>

<script src="https://gist.github.com/igorkulman/0353b26073fc11d3635f.js?file=reg2.cs"></script>

<p>and for &#8220;classic&#8221; .NET (Windows Phone 8)</p>

<script src="https://gist.github.com/igorkulman/0353b26073fc11d3635f.js?file=reg3.cs"></script>

<p>because of reflection differences in WinRT. Do not forget to add the PerRequest or Singleton attribute to your classes to make it work.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">24 Jun 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/converting-between-pixels-meters-and-map-coordinates-in-windows-phone/" class="post-title">Converting between pixels, meters and map coordinates in Windows Phone</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a><a class="post-category post-category-WinRT" href="https://github.com:1313/igorkulman/coding-journal//categories/winrt">WinRT</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>In my current project I needed to solve one quite interesting problem. Imagine you have a map with some pins representing points of interest. If the user taps on a pin, a label with the place title is shown like on this image (that is not from the real project, obviously).</p>

<p><img src="/images/image_thumb_4_4.png" alt="" class="pure-img" ></p>

<p>The client had an interesting requirement. When the user taps the pin and the label is shown, they wanted the label to be centered on the map (basically move the map so the label appears in the middle of the map).</p>

<p>In Windows Phone you can only center the map to a GeoCoordinate. If you center the map to the tapped pin&#8217;s coordinate, it is not quite right, you also need to move it by half the width of the label to the left (and half of the height down). So the solution consists of two steps</p>

<ol>
<li>Convert half of the label width in pixels to meters for a given zoom level (pixels -&gt; meters conversion)</li>
<li>Subtract the result from the pin&#8217;s coordinate (meters -&gt; degrees conversion)</li>
</ol>

<p>(and the same for height)</p>

<p>The map component in Windows Phone 8 and 8.1 has quite a <a href="http://msdn.microsoft.com/en-us/library/aa940990.aspx">nice documentation</a>, so the first step requires some math but is not so difficult.</p>

<p>I created two helper functions to take care of this first conversion</p>

<script src="https://gist.github.com/igorkulman/9fa0a229b9c2db57a172.js?file=meters.cs"></script>

<p>The second conversion is more difficult, especially if you want to do it really well. I found a <a href="https://gis.stackexchange.com/questions/2951/algorithm-for-offsetting-a-latitude-longitude-by-some-amount-of-meters">simple solution that works quite ok when you are not right at the poles</a> and used it. The helper function looks like this.</p>

<script src="https://gist.github.com/igorkulman/9fa0a229b9c2db57a172.js?file=coords.cs"></script>

<p>Now you just need to put it all together and you are done.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">11 Jun 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/ignoring-certificate-errors-in-windows-phone-8-1/" class="post-title">Ignoring certificate errors in Windows Phone 8.1</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Connecting to servers with self-signed, expired or otherwise problematic certificates has always been a problem in Windows Phone. There is no way to ignore certificate errors in Windows Phone 7 and Windows Phone 8, not even using the new Portable HTTP Client Libraries. If you are dealing with a self-signed certificate on the server, you have to somehow get it (may not always be possible) and install it on the device or in the emulator (for emulator every time you close and start it again). Ignoring certificate errors would be a much more comfortable approach. Of course, only do it in development with dev servers, not in production.</p>

<p>In Windows Phone 8.1 there are strangely two HttpClient classes, one in System.Net.Http and another in Windows.Web.Http. Normally you would go with the one in System.Net.Http because you are probably using it thanks to the mentioned Portable HTTP Client Libraries on every other platform. You are out of luck in Windows Phone 8.1 XAML, if you want to ignore certificate errors, you have to use the one from Windows.Web.Http, because only this one accepts an IHttpFilter as an argument.</p>

<p>Using the IHttpFilter, you can easily ignore certificate errors</p>

<p><script src="https://gist.github.com/76c9d8f1e79b6fd41c33.js"></script></p>

<p>but you have to get used to doing all the request in a different way, the Windows.Web.Http.HttpClient way that differs from the System.Net.Http.HttpClient way.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">23 Apr 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/making-your-windows-phone-silverlight-8-1-app-a-share-contract-target/" class="post-title">Making your Windows Phone Silverlight 8.1 app a Share Contract target</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Windows Phone 8.1 introduced many interesting new thing, the one I personally like the best as a developer is the Share Contract. The Share Contract allows your apps to share data using an unified and easy way and also to receive data from other apps. This functionality is important for my <a href="http://t.co/YMtrM84rwI">Pock8</a> app, which is a Pocket client. By making Pock8 app a Share Contract target, the app can receive links from other apps, more importantly from the built-in webrowser (IE). This makes the app even more easy to use and valuable.</p>

<p><img src="/images/wp81.png" alt="" class="pure-img" ></p>

<p>The problem is that <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh871367.aspx">all the documentation I found</a> and also <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh871363.aspx">the sample app</a> are for Windows Runtime. Pock8 is a Silverligt app and I have no intentions to rewrite it to Windows Runtime.</p>

<p>I had to make some digging and I finally found the solution in a build video called <a href="http://channel9.msdn.com/Events/Build/2014/2-520">Contracts and Pickers: Building Apps that Work Together on Windows</a>.</p>

<p>First you have to add the <strong>Share Contract</strong> ability to the new manifest file (Package.appxmanifest, the Declarations tab). If you want to receive links, Choose <strong>weblink</strong> as data format. This step is the same for Windows Runtime and for Silverlight apps, but all the other steps differ.</p>

<p>You can determine if your application was launched normally or as a Share Contract target in the application Launching event. If you cast the <strong>LaunchingEventArgs</strong> to <strong>ShareLaunchingEventArgs</strong> and the result is not null, your application was launched as a Share Contract target. The video recommend creating an internal property of type <strong>ShareOperation</strong> in App.xaml.cs and saving the data from <strong>ShareLaunchingEventArgs</strong> there:</p>

<script src="https://gist.github.com/igorkulman/11111043.js?file=AssociationUriMapper.cs"></script>

<p>(I use Caliburn.Micro so I do it in the OnLaunch method of the Bootstrapper)</p>

<p>The next thing to do is to show a separate sharing page instead of the page you would normally show when your app starts. Create a <strong>AssociationUriMapper</strong> like you <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj206987(v=vs.105).aspx">would do when registering for a protocol</a> and simply check the <strong>ShareOperation</strong> property in App.xaml.cs:</p>

<p>If you use Caliburn.Micro as I do, do not forget to register the AssociationUriMapper in the Boostrappers CreatePhoneApplicationFrame method:</p>

<script src="https://gist.github.com/igorkulman/11111043.js?file=CreatePhoneApplicationFrame.cs"></script>

                    </div>
                </section>
                
                <h1 class="content-subhead">07 Apr 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/crawling-mobile-app-stores-with-f/" class="post-title">Crawling mobile app stores with F#</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Functional programming" href="https://github.com:1313/igorkulman/coding-journal//categories/functional-programming">Functional programming</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Some time ago I needed a way to programatically search the Apple AppStore and Google Play Store to get some info about apps for a project. I decided to write an F# script for that task and later added support for Windows Phone Store.</p>

<p><strong>Types</strong></p>

<p>I wanted the script to be easily usable from outside of F# so first I created a type for the app.</p>

<script src="https://gist.github.com/igorkulman/10019990.js?file=types.fs"></script>

<p>I also needed a helper function to download data from the web. I used a classic WebClient with user agent set to Chrome, because the Windows Phone Store API requires a user agent header</p>

<script src="https://gist.github.com/igorkulman/10019990.js?file=net.fs"></script>

<p><strong>Apple AppStore</strong></p>

<p>Searching in Apple AppStore is easy, because Apple provides a simple search API that returns JSON. Thanks to the JsonProvider from FSharp.Data, the code is really simple</p>

<script src="https://gist.github.com/igorkulman/10019990.js?file=AppStore.fs"></script>

<p>Just downloading the JSON transforming the data to our type.</p>

<p><strong>Google Play Store</strong></p>

<p>Searching in Google Play Store is a bit more of a challenge. There is no API I could found so I had to parse the html returned from the web version of Google Play Store. The web can change at any time so I need to be aware of this fact and fix the method if it happens.</p>

<script src="https://gist.github.com/igorkulman/10019990.js?file=PlayStore.fs"></script>

<p>Another problem with parsing the web is that there is no way to return search result for a specific country like for Apple AppStore. The web always shows results according to your IP address.</p>

<p><strong>Windows Phone Store</strong></p>

<p>There is no official API for searching the Windows Phone Store but I was given a tip obtained after sniffing the traffic from a Windows Phone, so I did not have to parse the web. The code is as simple as for Apple AppStore thanks to XmlProvider.</p>

<script src="https://gist.github.com/igorkulman/10019990.js?file=WindowsPhoneStore.fs"></script>

<p><strong>Conclusion</strong></p>

<p>Using F# is fun and processing data is really simple thanks to type provides. You can find it whole code at <a href="https://github.com/igorkulman/AppStoreCrawler">https://github.com/igorkulman/AppStoreCrawler</a>.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">31 Mar 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/building-windows-phone-apps-with-fake/" class="post-title">Building Windows Phone apps with FAKE</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="http://fsharp.github.io/FAKE/">FAKE</a> is a build automation system with capabilities which are similar to make and rake. It is using an easy domain-specific language (DSL) so that you can start using it without learning F#. If you need more than the default functionality you can either write F# or simply reference .NET assemblies.</p>

<p>I have been using FAKE for quite some time now on some fairly complex projects for not only building but also running tests and creating and pushing Nuget packages and I really like. I decided to add FAKE build scripts to my Windows Phone apps to make the process of generating a XAP file for the Windows Phone Store easier.</p>

<p>The FAKE script I use can by used with any Windows Phone app, it will build all the projects and copy the XAP file to a release directory.</p>

<script src="https://gist.github.com/igorkulman/9842235.js?file=build.fsx"></script>

<p>To get the script started, you need a batch file</p>

<script src="https://gist.github.com/igorkulman/9842235.js?file=build.bat"></script>

<p>and Nuget.exe in tools\NuGet directory.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">24 Mar 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/how-to-get-rid-of-the-strange-line-under-systray-in-windows-phone-8/" class="post-title">How to get rid of the strange line under systray in Windows Phone 8</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>If you create an Windows Phone 8 app and test it only on WVGA and 720p devices or emulators, you may be surprised how you app looks on a WXGA device (or emulator).</p>

<p><img src="/images/line.png" alt="" class="pure-img" ></p>

<p>I have not been able the reason why this happens but the solution is quite simple. Set your page&#8217;s top border to -1.</p>

<script src="https://gist.github.com/igorkulman/9572347.js?file=line.xaml"></script>

<p>Doing this in XAML for every page is not very convenient, a better solution would be to set the negative top margin on the whole application frame</p>

<script src="https://gist.github.com/igorkulman/9572347.js?file=line.cs"></script>

<p>If you use Caliburn.Micro, you need to override the CreatePhoneApplicationFrame in the Bootstrapper instead</p>

<script src="https://gist.github.com/igorkulman/9572347.js?file=line.caliburn.cs"></script>

                    </div>
                </section>
                
                <h1 class="content-subhead">20 Mar 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/getting-contacts-on-windows-phone-the-asyncawait-way/" class="post-title">Getting contacts on Windows Phone the async/await way</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Getting contacts info on Windows Phone means using a callback based API provided by the Windows Phone SDK</p>

<script src="https://gist.github.com/igorkulman/9572748.js?file=Contacts.Standard.cs"></script>

<p>I really dislike all the callback-based API so I was looking for a way to convert it to an async/await based API. And it is quite easy to do so</p>

<script src="https://gist.github.com/igorkulman/9572748.js?file=AddressBookService.cs"></script>

<p>You can find this implementation in my <a href="https://github.com/igorkulman/Kulman.WP8">Kulman.WP8</a> library (also <a href="http://www.nuget.org/packages/Kulman.WP8/">available on Nuget</a>)</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">17 Mar 2014, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://github.com:1313/igorkulman/coding-journal/testing-in-app-purchases-in-windows-phone/" class="post-title">Testing in-app purchases in Windows Phone</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Windows Phone" href="https://github.com:1313/igorkulman/coding-journal//categories/windows-phone">Windows Phone</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Windows Phone Store does not offer developers any sandbox to test in-app purchases in their apps, like stores on other platforms do. If you want test in-app purchases in your Windows Phone apps, you need to use other options.</p>

<p>To make in-app purchases implementation easier, I created a simple Windows Phone Store service interface in my <a href="https://github.com/igorkulman/Kulman.WP8">Kulman.WP8</a> library (also <a href="http://www.nuget.org/packages/Kulman.WP8/">available on Nuget</a>)</p>

<script src="https://gist.github.com/igorkulman/9571908.js?file=IWindowsPhoneStoreService.cs"></script>

<p><strong>Private beta</strong></p>

<p>If you publish your app as a private beta and add the in-app products, you can test them. All the in-app purchases are always free in this scenario. The disadvantage is that you cannot debug anything, it either works or it does not (if you use my <a href="https://github.com/igorkulman/Kulman.WP8/blob/master/Kulman.WP8/Services/WindowsPhoneStoreService.cs">implementation from Kulman.WP8</a>, it should :).</p>

<p><strong>Real app testing</strong></p>

<p>If your app is already in the Windows Phone Store, create an in-app product and try to buy it from your app run from Visual Studio, you may be wondering, why you are getting an error. The problem is that the app run from Visual Studio has a different app id from the app in Windows Phone Store. If you change the app id in the manifest to the app id state in Windows Phone Store (the details view), you will be able to make a real in-app purchase.</p>

<p><strong>Mocking library</strong></p>

<p>To mock in-app purchases you can use the <a href="http://code.msdn.microsoft.com/wpapps/Mock-In-App-Purchase-33080f0c">Mock In-App Purchase Library</a>. To make testing easier, implement my interface using this library</p>

<p><script src="https://gist.github.com/9571846.js"></script></p>

<p>And setup the products you want to use at your app startup</p>

<script src="https://gist.github.com/igorkulman/9571908.js?file=SetupMockIAP.cs"></script>

<p>The advantage of this approach is that you just switch the IWindowsStoreService implementation between then mock on and the <a href="https://github.com/igorkulman/Kulman.WP8/blob/master/Kulman.WP8/Services/WindowsPhoneStoreService.cs">real one</a>, depending on the situation. For example (Caliburn.Micro Bootstrapper)</p>

<script src="https://gist.github.com/igorkulman/9571908.js?file=IAP.cs"></script>

                    </div>
                </section>
                
            </div>
            
<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
      
      <a href="/page/3/" class="post-list-pagination-item pure-button post-list-pagination-item-prev">
        <i class="fa fa-angle-double-left"></i>&nbsp;Newer
      </a>
      
    <span class="post-list-pagination-item post-list-pagination-item-current">Page 4 of 10</span>
    
      <a href="/page/5/" class="post-list-pagination-item pure-button post-list-pagination-item-next">
        Older&nbsp;<i class="fa fa-angle-double-right"></i>
      </a>
    
  </nav>
</div>


            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://github.com:1313/igorkulman/coding-journal//js/all.min.js"></script>
        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-49528577-2', 'auto');
ga('send', 'pageview');

</script>

<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
