<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F# on Azure: using Table Storage for logging &middot; Coding Journal</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.14" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="F# on Azure: using Table Storage for logging &middot; Coding Journal">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="F# on Azure: using Table Storage for logging &middot; Coding Journal">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="http://igorkulman.github.io/coding-journal/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Coding Journal" href="http://igorkulman.github.io/coding-journal/index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="http://igorkulman.github.io/coding-journal">Coding Journal</a></h1>
            <h2 class="brand-tagline"> Adventures in the world of C#, F# and WinRT </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/igorkulman"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/igorkulman "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="http://igorkulman.github.io/coding-journal/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>

<div>
<h2>About me</h2>

<p>Igor Kulman is currently working as Windows Phone developer, also building applications for Microsoft Azure and playing with F#.</p>
<p>
Interested in programming languages, functional programming and data science.</p>

</div>

    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">26 Feb 2013, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://igorkulman.github.io/coding-journal/f-on-azure-using-table-storage-for-logging/" class="post-title">F# on Azure: using Table Storage for logging</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">Igor Kulman</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Functional programming" href="http://igorkulman.github.io/coding-journal/categories/functional-programming">Functional programming</a><a class="post-category post-category-Windows Azure" href="http://igorkulman.github.io/coding-journal/categories/windows-azure">Windows Azure</a>
                            
                        </p>
                    </header>

                  
                    <div class="post-description">
                        <p>Windows Azure finally has a good F# support. Creating F# Worker Roles is supported right from the wizzard in Visual Studio and you can create a F# Web Role using the <a href="http://visualstudiogallery.msdn.microsoft.com/3d2bf938-fc9e-403c-90b3-8de27dc23095">F# C# MVC template</a>. I decided to try it out and the first thing I needed to implement was logging. I decided for logging to Azure Table Storage.</p>

<p>I assume you have a basic idea of how Azure Table Storage works. If not, there is a <a href="http://www.windowsazure.com/en-us/develop/net/how-to-guides/table-services/">good guide on the Windows Azure website</a>.</p>

<p>The first thing you need to do is to define your log entry class. You need to create a class, Azure Table Storage does not work with F# records. In my case I want to store a timestamp, message and severity.</p>

<p><script src="https://gist.github.com/5822037.js"></script></p>

<p>Alternatively you can make your class inherit from TableEntity that already contains the PartitionKey and RowKey properties. The Severity property is in my case just a simple discriminated union</p>

<p><script src="https://gist.github.com/5822042.js"></script></p>

<p>You can access the Azure API in C# way but you do not need to, there is a great library called <a href="http://dmohl.github.com/Fog/">Fog by Dan Mohl</a> that makes using Azure API from F# more comfortable.</p>

<p>First you create a Azure Table Storage client using a connection string defined in the Windows Azure Cloud Service Configuration file for a role</p>

<p><script src="https://gist.github.com/5822066.js"></script></p>

<p>Saving a log entry is then very simple thanks to Fog</p>

<p><script src="https://gist.github.com/5822061.js"></script></p>

<p>Saving data to Azure Table Storage may be a slow operation if you do it a lot, so you may want to log asynchronously</p>

<p><script src="https://gist.github.com/5822056.js"></script></p>

<p>As you may have noticed, I use the date as the partiotion key. The thing with Azure Table Storage is, that you can get the data by partition key, row key, or all the data. The log date seems like a reasonable partition key that allows you to get log by days</p>

<p><script src="https://gist.github.com/5822053.js"></script></p>

<p><strong>Update:</strong> there is a more way to create the LogEntity using the CLIMuttableAttribte</p>

<p><script src="https://gist.github.com/5822050.js"></script></p>

                    </div>
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'coudingjournal';
    var disqus_identifier = 'http:\/\/igorkulman.github.io\/coding-journal\/f-on-azure-using-table-storage-for-logging\/';
    var disqus_title = 'F# on Azure: using Table Storage for logging';
    var disqus_url = 'http:\/\/igorkulman.github.io\/coding-journal\/f-on-azure-using-table-storage-for-logging\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </section>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="http://igorkulman.github.io/coding-journal/js/all.min.js"></script>
        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-49528577-2', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
